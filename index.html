<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Trang m·∫≠t kh·∫©u ‚Üí Trung Thu (video fullscreen) ‚Üí L·ªùi ch√∫c</title>
  <style>
    :root{
      --bg:#fff8d3;
      --card:#0b1220;
      --accent:#06b6d4;
      --muted:#3b3b3b;
      --holo:#ffd54f;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:Inter, system-ui, Arial, sans-serif;background:linear-gradient(180deg,#fff8d3 0%, #ffd366 100%);color:#1a1a1a;display:flex;align-items:center;justify-content:center;padding:0}

    /* Card */
    .card{width:min(96vw,1200px);height:min(86vh,860px);background:var(--card);padding:12px;border-radius:14px;box-shadow:0 10px 30px rgba(2,6,23,0.7);color:#e6eef6;display:flex;flex-direction:column;gap:8px;position:relative}

    .page{position:relative;flex:1;display:flex;flex-direction:column}
    .page.hidden{display:none}

    /* ===== Page 1 (password) - background image ===== */
    .pw-holo{
      position:relative;
      border-radius:12px;
      padding:18px;
      flex:1;
      display:flex;
      flex-direction:column;
      justify-content:center;
      overflow:hidden;
      color:#fff8e6;
      text-shadow:0 2px 8px rgba(0,0,0,0.6);

      /* ∆∞u ti√™n load ·∫£nh online; fallback sang file local n·∫øu c·∫ßn */
      background-image:
        linear-gradient(135deg, rgba(11,18,32,0.45), rgba(11,18,32,0.25)),
        url('https://png.pngtree.com/background/20210714/original/pngtree-mid-autumn-festival-green-classical-background-picture-image_1219098.jpg'),
        url('/mnt/data/42d5c248-2d52-459a-bafb-91cad863fe87.png');
      background-size: cover, cover, cover;
      background-position: center, center, center;
      background-repeat: no-repeat;
      box-shadow:0 6px 20px rgba(0,0,0,0.45) inset;
      border:1px solid rgba(255,210,90,0.04);
    }
    .pw-holo .title{color:var(--holo);font-weight:700;margin-bottom:8px}

    input[type="password"]{width:100%;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));color:inherit;margin-bottom:12px}
    button{padding:10px 14px;border-radius:10px;border:0;background:linear-gradient(90deg,var(--accent),#7c3aed);color:#001021;font-weight:600;cursor:pointer}
    .muted{color:var(--muted);font-size:14px}
    .row{display:flex;gap:10px}

    /* rotation overlay */
    #rotateOverlay{position:fixed;inset:0;background:rgba(0,0,0,0.85);color:#fff;display:flex;align-items:center;justify-content:center;z-index:60;padding:20px;flex-direction:column;gap:12px;text-align:center}
    #rotateOverlay.hidden{display:none}
    @media (min-width:900px){ #rotateOverlay{display:none} }

    /* Video area */
    .video-full{flex:1;display:flex;align-items:center;justify-content:center;border-radius:10px;overflow:hidden;background:#000}
    .video-full iframe, .video-full > div{width:100%;height:100%;border:0}

    /* Continue button */
    #nextBtnContainer{position:absolute;left:50%;transform:translateX(-50%);bottom:26px;z-index:40}
    #nextBtnContainer.hidden{display:none}

    /* ===== Page 3 (greeting) ===== */
    /* background for greeting: use the URL you provided, fallback none */
    .page#page-greeting{
      background-image:
        linear-gradient(180deg, rgba(0,0,0,0.18), rgba(0,0,0,0.06)),
        url('https://upload.urbox.vn/strapi-mobile/medium_tet_trung_thu_feature_image_1_bc298a6819_50e2ccb958_96563ba48a.png');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      border-radius:12px;
      overflow:hidden;
      padding:18px;
    }

    .greeting{
  font-size:34px;
  text-align:center;
  display:flex;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  height:100%;
  position:relative;
  overflow:visible;
}

/* khung ch·ª©a ch·ªØ ri√™ng */
.greeting-content{
  padding:36px 28px;
  border-radius:14px;
  background:rgba(0,0,0,0.45); /* n·ªÅn m·ªù */
  backdrop-filter: blur(6px);
  box-shadow:0 6px 18px rgba(0,0,0,0.35);
  max-width:80%;
}

.greeting-content h1{
  font-size:48px;
  margin:0;
  color:#fff;
  text-shadow:0 4px 18px rgba(0,0,0,0.6);
}

.greeting-content p{
  margin-top:18px;
  font-size:16px;
  color:rgba(255,255,255,0.9);
}

   

    /* lanterns flying using your transparent lantern image */
    .lanterns{pointer-events:none;position:absolute;inset:0;z-index:56;overflow:hidden}
    .lantern{position:absolute;bottom:-30%;width:88px;height:auto;opacity:0;will-change:transform,opacity;transform-origin:center bottom;background-repeat:no-repeat;background-size:contain;background-position:center}
    .lantern.v1{animation:lanternUp 9.6s linear infinite;filter:drop-shadow(0 10px 22px rgba(0,0,0,0.35));}
    .lantern.v2{animation:lanternUp 11.4s linear infinite;filter:drop-shadow(0 12px 24px rgba(0,0,0,0.32));}
    .lantern.v3{animation:lanternUp 10.2s linear infinite;filter:drop-shadow(0 8px 18px rgba(0,0,0,0.28));}
    .lantern.v4{animation:lanternUp 12.2s linear infinite;filter:drop-shadow(0 9px 20px rgba(0,0,0,0.30));}
    .lantern.v5{animation:lanternUp 10.8s linear infinite;filter:drop-shadow(0 11px 22px rgba(0,0,0,0.34));}

    @keyframes lanternUp{
      0%   { transform: translateX(0) translateY(0) rotate(-6deg) scale(var(--s,1)); opacity:0; }
      6%   { opacity:1; }
      30%  { transform: translateX(var(--dx, 0px)) translateY(-30vh) rotate(6deg) scale(calc(var(--s,1)*1.03)); opacity:0.95; }
      60%  { transform: translateX(calc(var(--dx, 0px) * 1.15)) translateY(-62vh) rotate(-8deg) scale(calc(var(--s,1)*0.98)); opacity:0.7; filter:blur(0.6px); }
      100% { transform: translateX(calc(var(--dx, 0px) * 1.3)) translateY(-120vh) rotate(-10deg) scale(var(--s,1)); opacity:0; }
    }

    @media (max-width:720px){ .lion{width:160px;bottom:3%} .lantern{width:56px} }
    @media (max-width:520px){ .card{height:92vh} }
  </style>
</head>
<body>

  <div id="rotateOverlay" class="hidden" role="dialog" aria-modal="true">
    <div class="box">
      <h2>Xoay m√†n h√¨nh sang ngang ƒë·ªÉ tr·∫£i nghi·ªám t·ªët h∆°n</h2>
      <p>ƒê·ªÉ video hi·ªÉn th·ªã ƒë√∫ng t·ªâ l·ªá ngang v√† to√†n m√†n h√¨nh, h√£y xoay thi·∫øt b·ªã sang ch·∫ø ƒë·ªô ngang (landscape).</p>
      <div style="display:flex;gap:10px;justify-content:center;margin-top:10px">
        <button id="tryLockBtn" class="rotateBtn">Th·ª≠ kh√≥a ngang</button>
        <button id="dismissRotate" style="background:transparent;border:1px solid rgba(255,255,255,0.12);color:#fff;padding:10px 12px;border-radius:10px">ƒê√£ hi·ªÉu</button>
      </div>
    </div>
  </div>

  <div class="card" id="mainCard">

    <!-- Page 1: password -->
    <div id="page-password" class="page pw-holo">
      <div class="title">Nh·∫≠p m·∫≠t kh·∫©u ƒë·ªÉ b·∫Øt ƒë·∫ßu</div>
      <p class="muted" style="color:rgba(255,255,255,0.9)">Nh·∫≠p m·∫≠t kh·∫©u ƒë√∫ng.</p>
      <input id="pw" type="password" placeholder="Nh·∫≠p m·∫≠t kh·∫©u..." autocomplete="off" />
      <div class="row" style="margin-top:6px">
        <button id="btnEnter">B·∫Øt ƒë·∫ßu</button>
        <button id="btnHint" style="background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.04)">G·ª£i √Ω</button>
      </div>
      <p id="pwMsg" class="muted" style="margin-top:10px;color:rgba(255,255,255,0.85)"></p>
    </div>

    <!-- Page 2: video fullscreen inside card -->
    <div id="page-video" class="page hidden" style="position:relative">
      <div class="video-full" id="videoFull">
        <!-- YouTube player will be injected here by API -->
        <div id="player"></div>
      </div>

      <div id="nextBtnContainer" class="hidden">
        <button id="btnNext">Ti·∫øp t·ª•c</button>
      </div>

      <div style="position:absolute;right:12px;top:12px;z-index:50"><button id="btnBackToPw" style="background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.04)">Quay l·∫°i</button></div>
    </div>

    <!-- Page 3: greeting -->
    <!-- note: background for this page set via CSS above (your provided URL) -->
    <div id="page-greeting" class="page hidden">
      <!-- lanterns -->
      <div class="lanterns" id="lanterns"></div>

      <div class="greeting">
  <div class="greeting-content">
    <h1>üåï‚ú® Ch√∫c b·∫°n Trung Thu vui v·∫ª! ‚ú®üåï</h1>
    
  </div>
</div>
    </div>

  </div>

  <!-- YouTube IFrame API -->
  <script src="https://www.youtube.com/iframe_api"></script>
  <script>
    // CONFIG
    const PASSWORD = '11223344';
    const VIDEO_ID = 'gL5pDe7cqco';
    const NEXT_DELAY_RATIO = 2/3; // show button after 2/3 of video
    const AUTO_RETURN_MS = 30000;

    // Elements
    const rotateOverlay = document.getElementById('rotateOverlay');
    const tryLockBtn = document.getElementById('tryLockBtn');
    const dismissRotate = document.getElementById('dismissRotate');
    const pagePw = document.getElementById('page-password');
    const pageVideo = document.getElementById('page-video');
    const pageGreeting = document.getElementById('page-greeting');
    const pwInput = document.getElementById('pw');
    const btnEnter = document.getElementById('btnEnter');
    const btnHint = document.getElementById('btnHint');
    const pwMsg = document.getElementById('pwMsg');
    const nextBtnContainer = document.getElementById('nextBtnContainer');
    const btnNext = document.getElementById('btnNext');
    const btnBackToPw = document.getElementById('btnBackToPw');
    const mainCard = document.getElementById('mainCard');

    // lantern local transparent PNG (uploaded to container)
    const LANTERN_SRC = '/mnt/data/image-removebg-preview.png';

    let player = null;
    let checkInterval = null;
    let autoReturnTimeout = null;

    // Orientation helpers
    function checkOrientationAndPrompt(){
      const isPortrait = window.matchMedia('(orientation: portrait)').matches;
      const narrow = window.matchMedia('(max-width:900px)').matches;
      if(isPortrait && narrow){ rotateOverlay.classList.remove('hidden'); } else { rotateOverlay.classList.add('hidden'); }
    }
    async function tryLockLandscape(){
      try { if(screen.orientation && screen.orientation.lock){ await screen.orientation.lock('landscape'); rotateOverlay.classList.add('hidden'); return true; } }
      catch(e){ console.warn('Kh√¥ng th·ªÉ kh√≥a h∆∞·ªõng:', e); }
      return false;
    }
    dismissRotate.addEventListener('click', ()=>{ rotateOverlay.classList.add('hidden'); });
    tryLockBtn.addEventListener('click', async ()=>{ const ok = await tryLockLandscape(); if(!ok) alert('Tr√¨nh duy·ªát kh√¥ng cho ph√©p kh√≥a h∆∞·ªõng ‚Äî xoay thi·∫øt b·ªã th·ªß c√¥ng.'); });
    function setupGestureLock(){ const gesture = ()=>{ tryLockLandscape(); window.removeEventListener('touchstart', gesture); window.removeEventListener('click', gesture); }; window.addEventListener('touchstart', gesture, {passive:true}); window.addEventListener('click', gesture); }

    // --- YouTube player setup ---
    function onYouTubeIframeAPIReady(){
      player = new YT.Player('player', {
        height: '100%', width: '100%', videoId: VIDEO_ID,
        playerVars: { 'playsinline': 1, 'rel': 0, 'showinfo': 0 },
        events: {
          'onReady': onPlayerReady,
          'onStateChange': onPlayerStateChange
        }
      });
    }
    function onPlayerReady(event){ /* nothing yet */ }
    function onPlayerStateChange(e){
      if(e.data === YT.PlayerState.ENDED){ showContinueButton(); }
    }

    function startAndMonitorVideo(){
      if(!player) return;
      try{ player.playVideo(); }catch(e){ console.warn('playVideo failed', e); }
      requestFullscreenFor(mainCard);
      clearInterval(checkInterval);
      checkInterval = setInterval(()=>{
        try{
          const dur = player.getDuration();
          const cur = player.getCurrentTime();
          if(dur > 0 && cur/dur >= NEXT_DELAY_RATIO){ showContinueButton(); }
        }catch(e){ }
      }, 500);
    }
    function showContinueButton(){ nextBtnContainer.classList.remove('hidden'); if(checkInterval) clearInterval(checkInterval); }
    function stopAndCleanupVideo(){ try{ if(player && player.stopVideo) player.stopVideo(); }catch(e){} if(checkInterval) clearInterval(checkInterval); nextBtnContainer.classList.add('hidden'); exitFullscreenIfAny(); }

    async function requestFullscreenFor(el){
      try{
        if(el.requestFullscreen) await el.requestFullscreen();
        else if(el.webkitRequestFullscreen) el.webkitRequestFullscreen();
        else if(el.msRequestFullscreen) el.msRequestFullscreen();
      }catch(e){ console.warn('Fullscreen request failed', e); }
    }
    async function exitFullscreenIfAny(){
      try{ if(document.fullscreenElement) await document.exitFullscreen(); }
      catch(e){ /* ignore */ }
    }

    // Page flow
    btnEnter.addEventListener('click', ()=>{
      const val = pwInput.value.trim();
      if(!val){ pwMsg.textContent='Vui l√≤ng nh·∫≠p m·∫≠t kh·∫©u.'; return; }
      if(val === PASSWORD){
        checkOrientationAndPrompt();
        showPage('video');
        startAndMonitorVideo();
      } else { pwMsg.textContent='M·∫≠t kh·∫©u kh√¥ng ƒë√∫ng ‚Äî th·ª≠ l·∫°i.'; }
    });

    function showPage(name){
      pagePw.classList.add('hidden'); pageVideo.classList.add('hidden'); pageGreeting.classList.add('hidden');
      if(name==='pw') pagePw.classList.remove('hidden');
      if(name==='video') pageVideo.classList.remove('hidden');
      if(name==='greeting') pageGreeting.classList.remove('hidden');
      if(name==='greeting') prepareGreetingVisuals();
    }

    btnNext.addEventListener('click', ()=>{ stopAndCleanupVideo(); showGreeting(); });
    btnBackToPw.addEventListener('click', ()=>{ stopAndCleanupVideo(); showPage('pw'); pwInput.value=''; pwMsg.textContent=''; clearAutoReturn(); });

    function showGreeting(){
      showPage('greeting');
      clearAutoReturn();
      autoReturnTimeout = setTimeout(()=>{ showPage('pw'); pwInput.value=''; pwMsg.textContent=''; }, AUTO_RETURN_MS);
      let remaining = AUTO_RETURN_MS/1000; const notice = document.getElementById('autoReturnNotice'); notice.textContent = `Trang s·∫Ω t·ª± tr·ªü v·ªÅ sau ${remaining} gi√¢y.`;
      const countdown = setInterval(()=>{ remaining--; if(remaining<=0){ clearInterval(countdown); notice.textContent = 'ƒê√£ tr·ªü v·ªÅ trang ƒë·∫ßu.'; return } notice.textContent = `Trang s·∫Ω t·ª± tr·ªü v·ªÅ sau ${remaining} gi√¢y.`; },1000);
    }
    function clearAutoReturn(){ if(autoReturnTimeout) clearTimeout(autoReturnTimeout); }

    // ===== Lanterns & greeting visuals =====
    function createLanterns(count = 7){
      const container = document.getElementById('lanterns');
      if(!container) return;
      container.innerHTML = '';
      for (let i=0;i<count;i++){
        const el = document.createElement('div');
        el.className = 'lantern v' + ((i%5)+1);
        const left = 6 + Math.random()*88;
        el.style.left = `${left}%`;
        const dx = (Math.random()*160 - 80).toFixed(1) + 'px';
        el.style.setProperty('--dx', dx);
        const s = (0.8 + Math.random()*0.6).toFixed(2);
        el.style.setProperty('--s', s);
        el.style.animationDelay = (Math.random()*-10).toFixed(2) + 's';
        el.style.backgroundImage = `url("${LANTERN_SRC}")`;
        container.appendChild(el);
      }
    }
    function ensureLanternsCreated(){ if(document.getElementById('lanterns') && !document.getElementById('lanterns').children.length) createLanterns(8); }

    function prepareGreetingVisuals(){
      ensureLanternsCreated();
      // small glow pulse for lanterns
      const lanterns = document.querySelectorAll('.lantern');
      lanterns.forEach((l,idx)=>{
        l.style.transition = 'filter 0.6s ease';
        setTimeout(()=> l.style.filter = 'drop-shadow(0 16px 36px rgba(255,160,50,0.35))', 300 + idx*80);
        setTimeout(()=> l.style.filter = '', 2600 + idx*40);
      });
      // lions are local images; they should be visible directly
    }

    // init
    checkOrientationAndPrompt();
    setupGestureLock();
    window.addEventListener('orientationchange', checkOrientationAndPrompt);
    window.addEventListener('resize', checkOrientationAndPrompt);

    // show first page
    showPage('pw');
  </script>
</body>
</html>
